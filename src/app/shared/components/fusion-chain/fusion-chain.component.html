<!-- Demon and Level -->
<form class="demon-form">
	<mat-form-field class="demon-form-field" appearance="fill">
		<mat-label>Demon</mat-label>
		<input
			type="text"
			placeholder="Mara"
			aria-label="Demon Name"
			matInput
			[formControl]="demonControl"
			[matAutocomplete]="auto"
		/>
		<mat-autocomplete #auto="matAutocomplete">
			<mat-option
				*ngFor="let demon of filteredDemons | async"
				[value]="demon"
			>
				{{ demon }}
			</mat-option>
		</mat-autocomplete>
	</mat-form-field>
	<mat-form-field class="demon-form-field" appearance="fill">
		<mat-label>Max Level</mat-label>
		<input type="number" matInput [formControl]="levelControl" />
	</mat-form-field>
</form>

<!-- Skills -->
<div class="skills" layout="column">
	<ng-container *ngFor="let skillControl of skillControls; let i = index">
		<form class="skill-form">
			<mat-form-field class="skill-form-field" appearance="fill">
				<mat-label>Skill {{ i + 1 }}</mat-label>
				<input
					type="text"
					placeholder="Maragi"
					aria-label="Skill"
					matInput
					[formControl]="skillControl"
					[matAutocomplete]="auto"
				/>
				<mat-autocomplete #auto="matAutocomplete">
					<mat-option
						*ngFor="let skill of filteredSkills[i] | async"
						[value]="skill"
					>
						{{ skill }}
					</mat-option>
				</mat-autocomplete>
			</mat-form-field>
		</form>
	</ng-container>
</div>

<!-- Buttons -->
<div class="buttons">
	<button (click)="calculate()" color="primary" mat-raised-button>
		Calculate
	</button>
	<button (click)="test()" color="warn" mat-raised-button>Testing</button>
	<button (click)="log()" color="warn" mat-raised-button>Log</button>
</div>

<!-- Chain Display -->
<div class="accordion" *ngIf="chains">
	<mat-accordion>
		<mat-expansion-panel *ngFor="let chain of chains; let i = index">
			<mat-expansion-panel-header>
				<mat-panel-title>
					{{ chain.result }}
				</mat-panel-title>
				<mat-panel-description>
					<p>
						Price: {{ chain.cost | number: '1.0':'en-US' }} Level
						Required: {{ chain.level }} Steps:
						{{ chain.steps.length }}
					</p>
				</mat-panel-description>
			</mat-expansion-panel-header>
			<ng-container *ngFor="let recipe of chain.steps; let j = index">
				<div style="white-space: pre">
					Step {{ j + 1 }}: Fuse
					<ng-container *ngFor="let source of recipe.sources">
						{{ source }},
					</ng-container>
					to make {{ recipe.result }}. Have
					{{ recipe.result }} inherit
					<ng-container
						*ngFor="let skill of chain.inherittedSkills[j]"
					>
						{{ skill }},
					</ng-container>
				</div>
			</ng-container>
			<div>
				{{ chain.result }} will learn
				<ng-container *ngFor="let skill of chain.innates">
					{{ skill }}
				</ng-container>
				on it's own.
			</div>
		</mat-expansion-panel>
	</mat-accordion>
</div>
